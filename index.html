<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simple Expense Tracker</title>
<style>
  :root{--maxw:900px;--accent:#1976d2;}
  body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:#f4f6f8;color:#111;display:flex;align-items:flex-start;justify-content:center;padding:28px;}
  .app{width:100%;max-width:var(--maxw);background:#fff;border-radius:10px;box-shadow:0 8px 30px rgba(18,20,24,0.06);padding:18px;box-sizing:border-box;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;}
  header h1{font-size:18px;margin:0}
  .row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;}
  label{font-size:13px;color:#333}
  input[type="text"], input[type="number"], input[type="date"], select{
    padding:8px 10px;border-radius:6px;border:1px solid #d7dbe0;background:#fff;min-width:0;
  }
  button{background:var(--accent);color:#fff;border:none;padding:9px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .muted{color:#666;font-size:13px}
  form .col{display:flex;flex-direction:column;gap:6px}
  .controls{display:flex;gap:8px;align-items:center}
  .totals{display:flex;gap:14px;align-items:center;margin-top:6px}
  .panel{margin-top:12px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px 10px;text-align:left;border-bottom:1px solid #eef0f3;font-size:14px}
  th{font-weight:700;color:#333;background:#fafafa}
  td.amount{font-weight:700}
  .right{margin-left:auto}
  .small-btn{background:#e6eefc;color:var(--accent);padding:6px 8px;border-radius:6px;border:1px solid rgba(25,118,210,0.08);cursor:pointer}
  .danger{background:#ffecec;color:#c33;border:none;padding:6px 8px;border-radius:6px}
  .flex-between{display:flex;align-items:center;justify-content:space-between}
  footer{margin-top:14px;font-size:13px;color:#666;text-align:center}
  @media (max-width:640px){
    header{flex-direction:column;align-items:flex-start}
    .row{flex-direction:column}
    .controls{width:100%;justify-content:space-between}
  }
</style>
</head>
<body>
<div class="app" role="main">
  <header>
    <h1>Simple Expense Tracker</h1>
    <div class="muted">Saves to your browser â€” private to you</div>
  </header>

  <section aria-labelledby="add">
    <form id="form" onsubmit="return false">
      <div class="row">
        <div class="col" style="flex:1;min-width:160px">
          <label>Date</label>
          <input id="date" type="date" required>
        </div>
        <div class="col" style="width:120px">
          <label>Amount</label>
          <input id="amount" type="number" step="0.01" min="0" required>
        </div>
        <div class="col" style="min-width:140px">
          <label>Category</label>
          <select id="category">
            <option value="Food">Food</option>
            <option value="Transport">Transport</option>
            <option value="Bills">Bills</option>
            <option value="Salary">Salary</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="col" style="flex:1;min-width:160px">
          <label>Note (optional)</label>
          <input id="note" type="text" placeholder="e.g., lunch, taxi">
        </div>

        <div class="controls" style="align-self:end">
          <button id="addBtn">Add Expense</button>
        </div>
      </div>
    </form>

    <div class="totals">
      <div class="muted">Showing:
        <select id="filterMonth">
          <option value="all">All time</option>
        </select>
      </div>
      <div style="margin-left:auto">
        <strong>Total:</strong> <span id="total">0.00</span>
      </div>
      <div style="margin-left:8px">
        <button id="exportCsv" class="small-btn">Export CSV</button>
      </div>
      <div style="margin-left:8px">
        <button id="clearAll" class="danger">Clear All</button>
      </div>
    </div>
  </section>

  <section class="panel">
    <div class="flex-between">
      <strong>Expenses</strong>
      <div class="muted" id="count"></div>
    </div>

    <table id="tbl" aria-live="polite">
      <thead>
        <tr><th>Date</th><th>Category</th><th>Note</th><th>Amount</th><th>Action</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <footer>Tip: this stores data in your browser. To keep across devices later we can connect Google Sheets or Firebase.</footer>
</div>

<script>
  // Key names
  const STORAGE_KEY = 'simple_expenses_v1';

  // Elements
  const dateInput = document.getElementById('date');
  const amountInput = document.getElementById('amount');
  const categoryInput = document.getElementById('category');
  const noteInput = document.getElementById('note');
  const addBtn = document.getElementById('addBtn');
  const tbody = document.querySelector('#tbl tbody');
  const totalEl = document.getElementById('total');
  const countEl = document.getElementById('count');
  const filterMonth = document.getElementById('filterMonth');
  const exportCsv = document.getElementById('exportCsv');
  const clearAll = document.getElementById('clearAll');

  // In-memory list
  let expenses = [];

  // Helpers
  function load(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      expenses = raw ? JSON.parse(raw) : [];
    } catch(e){
      expenses = [];
    }
  }
  function save(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
  }
  function formatMoney(v){ return parseFloat(v).toFixed(2); }
  function monthKeyFromDate(d){
    const dt = new Date(d);
    return dt.getFullYear() + '-' + String(dt.getMonth()+1).padStart(2,'0');
  }

  // Populate month filter
  function refreshMonthFilter(){
    const months = new Set(expenses.map(e => monthKeyFromDate(e.date)));
    // clear options except 'all'
    filterMonth.innerHTML = '<option value="all">All time</option>';
    Array.from(months).sort().reverse().forEach(m => {
      const opt = document.createElement('option');
      opt.value = m;
      // human label like "2025-10"
      opt.textContent = m;
      filterMonth.appendChild(opt);
    });
  }

  // Render list (apply month filter)
  function render(){
    const filter = filterMonth.value;
    tbody.innerHTML = '';
    let total = 0;
    let count = 0;
    const list = expenses.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
    list.forEach((e, idx) => {
      if (filter !== 'all' && monthKeyFromDate(e.date) !== filter) return;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${e.date}</td>
        <td>${escapeHtml(e.category)}</td>
        <td>${escapeHtml(e.note||'')}</td>
        <td class="amount">${formatMoney(e.amount)}</td>
        <td><button class="small-btn" data-index="${idx}">Delete</button></td>`;
      tbody.appendChild(tr);
      total += Number(e.amount);
      count++;
    });
    totalEl.textContent = formatMoney(total);
    countEl.textContent = count + ' items';
  }

  // safe escape
  function escapeHtml(str){
    return String(str||'').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]));
  }

  // Add expense
  addBtn.addEventListener('click', ()=>{
    const date = dateInput.value || (new Date()).toISOString().slice(0,10);
    const amount = parseFloat(amountInput.value || 0);
    const category = categoryInput.value;
    const note = noteInput.value.trim();
    if (!date || !amount || isNaN(amount) || amount <= 0) {
      alert('Please enter a valid date and positive amount.');
      return;
    }
    const obj = { id: Date.now(), date, amount: Number(amount.toFixed(2)), category, note };
    expenses.push(obj);
    save();
    refreshMonthFilter();
    render();
    // reset inputs
    amountInput.value=''; noteInput.value='';
  });

  // Delete handler (event delegation)
  tbody.addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if (!btn) return;
    const idx = Number(btn.dataset.index);
    // idx corresponds to sorted array; map to actual
    const sorted = expenses.slice().sort((a,b)=> new Date(b.date)-new Date(a.date));
    const item = sorted[idx];
    if (!item) return;
    if (!confirm('Delete this entry?')) return;
    // remove by id
    expenses = expenses.filter(x => x.id !== item.id);
    save();
    refreshMonthFilter();
    render();
  });

  // Export CSV
  exportCsv.addEventListener('click', ()=>{
    if (!expenses.length){ alert('No expenses to export'); return; }
    const cols = ['date','category','note','amount'];
    const rows = expenses.slice().sort((a,b)=> new Date(a.date)-new Date(b.date)).map(e => 
      cols.map(c => `"${String(e[c]||'').replace(/"/g,'""')}"`).join(',')
    );
    const csv = [cols.join(','), ...rows].join('\r\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'expenses.csv'; document.body.appendChild(a); a.click();
    a.remove(); URL.revokeObjectURL(url);
  });

  // Clear all
  clearAll.addEventListener('click', ()=>{
    if (!confirm('Clear ALL expenses? This cannot be undone.')) return;
    expenses = []; save(); refreshMonthFilter(); render();
  });

  // Month filter change
  filterMonth.addEventListener('change', render);

  // Initialize default date to today
  (function init(){
    load();
    // set today date
    dateInput.value = (new Date()).toISOString().slice(0,10);
    refreshMonthFilter();
    render();
  })();
</script>
</body>
</html>
